ggplot(d2, aes(x = value, y = depth)) +   geom_point(size = 1) +   facet_grid(yr ~ mon, scales = 'free_x')
ggplot(d2, aes(x = value, y = depth)) +   geom_point(size = 1) +   scale_y_reverse() +   facet_grid(yr ~ mon, scales = 'free_x')
ggplot(d2, aes(x = value, y = depth)) +   geom_line() +   scale_y_reverse() +   facet_wrap(~ time, scales = 'free_x')
library(gdata)d <- read.table("~/Documents/SFEwq/data/res1395/res1395.txt", sep = '|', head=FALSE, as.is=TRUE, fill=TRUE)d <- d[, -44]names(d)[c(13, 36)] <- cs(capacity, date)d <- transform(d, date = as.Date(date))
d[d$V2 == 'INDIAN VALLEY', date] == as.Date('1976-01-01')
str(d)
subset(d, V2=='INDIAN VALLEY')
d[d$V2 == 'INDIAN VALLEY', date]
as.Date('1976-01-01')
d[d$V2 == 'INDIAN VALLEY', 'date'] <- as.Date('1976-01-01')
d <- transform(d, year = years(date))
d <- d[order(d$date), ]
head(d)
d <- transform(d, capacity_cum = cumsum(capacity))
xyplot(capacity_cumsum ~ year, data=d)
library(lattice)
xyplot(capacity_cumsum ~ year, data=d)
xyplot(capacity_cum ~ year, data=d)
xyplot(capacity_cum ~ year, type = 'l', data=d)
qplot(year, capacity_cum, , data=d, geom = 'line')
library(ggplot2)
qplot(year, capacity_cum, , data=d, geom = 'line')
unique(d$V4)
subset
x=1
y=72
z=rnorm(10)
fix(z)
plot(rnorm(10))
setwd("~/Documents/SFEwq/analysis")
source("~/.active.document")
ls()
View(runoff.8r)
source("~/.active.document")
load('srwtp.rda')
load('fish.rda')
load('srwtp.rda')
delta_smelt <- fish.yts[, 'dsmelt.tns']
tsi <- ts.intersect(delta_smelt, nhxconc.yts, nhxload.yts)
plot(tsi)
cor.test(~ delta_smelt + nhxload.yts, data=tsi)
cor.test(~ delta_smelt + nhxconc.yts, data=tsi)
args(cor.test)
?cor.test
cor.test(~ delta_smelt + nhxconc.yts, method='spearman', data=tsi)
cor.test(~ delta_smelt + nhxload.yts, method='spearman', data=tsi)
cor.test(~ delta_smelt + nhxload.yts, method='kendall', data=tsi)
cor.test(~ delta_smelt + nhxconc.yts, method='kendall', data=tsi)
load('fish.rda')
load('srwtp.rda')
delta_smelt <- fish.yts[, 'dsmelt.tns']
tsi <- ts.intersect(delta_smelt, nhxconc.yts, nhxload.yts)
plot(tsi)
cor.test(~ delta_smelt + nhxload.yts, data=tsi)
cor.test(~ delta_smelt + nhxconc.yts, data=tsi)
cor.test(~ delta_smelt + nhxload.yts, method='spearman', data=tsi)
cor.test(~ delta_smelt + nhxconc.yts, method='spearman', data=tsi)
cor.test(~ delta_smelt + nhxload.yts, method='kendall', data=tsi)
cor.test(~ delta_smelt + nhxconc.yts, method='kendall', data=tsi)
cor.test(~ delta_smelt + nhxload.yts, data=tsi)
cor.test(~ delta_smelt + nhxconc.yts, data=tsi)
cor.test(~ delta_smelt + nhxload.yts, method='spearman', data=tsi)
cor.test(~ delta_smelt + nhxconc.yts, method='spearman', data=tsi)
load('fish.rda')
load('srwtp.rda')
delta_smelt <- fish.yts[, 'dsmelt.tns']
nhx_conc <- nhxconc.yts
tsi <- ts.intersect(delta_smelt, nhx_conc)
d <- data.frame(tsi, year = as.numeric(time(tsi)))
d_cus <- apply(scale(d[, -3]), 2, cumsum)
d_9205 <- subset(d, year %in% c(1992:2005))
d_cus_9205 <- apply(scale(d_9205[, -3]), 2, cumsum)
cor.test(~ delta_smelt + nhx_conc, data=d)  # p=0.68, r=-0.096
cor.test(~ delta_smelt + nhx_conc, data=d_cus)  # p=0.51, r=+0.15
cor.test(~ delta_smelt + nhx_conc, data=d_9205)  # p=0.086, r=-0.49
cor.test(~ delta_smelt + nhx_conc, data=d_cus_9205)  # p=0.011, r=-0.68
ar.mle(log(na.contiguous(delta_smelt)), order.max=1)  # 69-09, 0.742
ar.mle(log(d_9205$delta_smelt), order.max=1)  # order 0
ar.mle(d_9205$nhx_conc, order.max=1)  # order 1: 0.932
ar.mle(d$nhx_conc, order.max=1)  # order 1: 0.968
len <- 14
reps <- 1000
rho <- 0.891
ans <- matrix(NA, ncol = 2, nrow = reps)
for (i in 1:reps) {
x <- rnorm(len)
y <- arima.sim(list(ar = rho), len, rnorm)
x <- scale(x)
y <- scale(y)
x_cus <- cumsum(x)
y_cus <- cumsum(y)
ans[i, ] <- c(cor(x, y), cor(x_cus, y_cus))
}
colnames(ans) <- c('orig', 'cus')
q_orig <- quantile(ans[, 'orig'], probs = c(.00005, .025, .975, .99995))  # -0.8771817 -0.5548518  0.5520917  0.8885537
q_cus <- quantile(ans[, 'cus'], probs = c(.00005, .025, .975, .99995))  # -0.9698017 -0.8222606  0.8198207  0.9762103
f <- ecdf(ans[, 'cus'])
pointo5 <- q_orig[2:3]
type1 <- f(pointo5)[1] + (1 - f(pointo5)[2])
q_cus
q_orig
len <- 14
reps <- 100000
rho <- 0.891
ans <- matrix(NA, ncol = 2, nrow = reps)
for (i in 1:reps) {
x <- rnorm(len)
y <- arima.sim(list(ar = rho), len, rnorm)
x <- scale(x)
y <- scale(y)
x_cus <- cumsum(x)
y_cus <- cumsum(y)
ans[i, ] <- c(cor(x, y), cor(x_cus, y_cus))
}
colnames(ans) <- c('orig', 'cus')
q_orig <- quantile(ans[, 'orig'], probs = c(.00005, .025, .975, .99995))  # -0.7832630 -0.5472784  0.5626449  0.8865502
q_cus <- quantile(ans[, 'cus'], probs = c(.00005, .025, .975, .99995))  # -0.9401308 -0.8164036  0.7957008  0.9695648
f <- ecdf(ans[, 'cus'])
pointo5 <- q_orig[2:3]
type1 <- f(pointo5)[1] + (1 - f(pointo5)[2])
q_cus
q_orig
type1
len <- 21
reps <- 100000
rho <- 0.940
ans <- matrix(NA, ncol = 2, nrow = reps)
for (i in 1:reps) {
x <- rnorm(len)
y <- arima.sim(list(ar = rho), len, rnorm)
x <- scale(x)
y <- scale(y)
x_cus <- cumsum(x)
y_cus <- cumsum(y)
ans[i, ] <- c(cor(x, y), cor(x_cus, y_cus))
}
colnames(ans) <- c('orig', 'cus')
q_orig <- quantile(ans[, 'orig'], probs = c(.00005, .025, .975, .99995))  # -0.8563459 -0.5315764  0.5333523  0.8607275
q_cus <- quantile(ans[, 'cus'], probs = c(.00005, .025, .975, .99995))  # -0.9665575 -0.8164994  0.8175849  0.9718333
f <- ecdf(ans[, 'cus'])
pointo5 <- q_orig[2:3]
type1 <- f(pointo5)[1] + (1 - f(pointo5)[2])  # 34%
type1
q_orig
q_cus
len <- 14
reps <- 100000
rho <- 0.891
ans <- matrix(NA, ncol = 2, nrow = reps)
for (i in 1:reps) {
x <- rnorm(len)
y <- arima.sim(list(ar = rho), len, rnorm)
x <- scale(x)
y <- scale(y)
x_cus <- cumsum(x)
y_cus <- cumsum(y)
ans[i, ] <- c(cor(x, y), cor(x_cus, y_cus))
}
colnames(ans) <- c('orig', 'cus')
q_orig <- quantile(ans[, 'orig'], probs = c(.00005, .025, .975, .99995))  # -0.7832630 -0.5472784  0.5626449  0.8865502
q_cus <- quantile(ans[, 'cus'], probs = c(.00005, .025, .975, .99995))  # -0.9401308 -0.8164036  0.7957008  0.9695648
f <- ecdf(ans[, 'cus'])
pointo5 <- q_orig[2:3]
type1 <- f(pointo5)[1] + (1 - f(pointo5)[2])
q_cus
q_orig
type1
load('fish.rda')
load('srwtp.rda')
delta_smelt <- fish.yts[, 'dsmelt.tns']
nhx_conc <- nhxconc.yts
tsi <- ts.intersect(delta_smelt, nhx_conc)
d <- data.frame(tsi, year = as.numeric(time(tsi)))
d_cus <- apply(scale(d[, -3]), 2, cumsum)
d_9205 <- subset(d, year %in% c(1992:2005))
d_cus_9205 <- apply(scale(d_9205[, -3]), 2, cumsum)
### Correlations with no serial correlation
cor.test(~ delta_smelt + nhx_conc, data=d)  # p=0.30, r=-0.24
cor.test(~ delta_smelt + nhx_conc, data=d_cus)  # p=0.69, r=-0.091
source("~/.active.document")
###################################################
### Initialize
###################################################
###
setwd('~/Documents/sfewq/analysis')
library(wq)
#sourceDir('~/RPackages/wq_package/wq/R')  # latest revisions of wq
### Data sets
load('sfe.rda')
load('dayflow.rda')
load('flow.ui.rda')
### Libraries
library(gdata)
library(ggplot2)
library(lattice)
setwd('~/D1ocuments/sfewq/analysis')
setwd('~/Documents/sfewq/analysis')
library(wq)
#sourceDir('~/RPackages/wq_package/wq/R')  # latest revisions of wq
### Data sets
load('sfe.rda')
load('flow.rda')
load('flow.ui.rda')
### Libraries
library(gdata)
library(ggplot2)
library(lattice)
setwd("~/Documents/SFEwq/analysis")
load('sfe.rda')
load('flow.rda')
load('flow.ui.rda')
source("~/.active.document")
ratios = transform(runoff.ui, sac1 = sac.octmar/sac.wysum, sac2 = sac.aprjul/sac.wysum, sjr1 = sjr.octmar/sjr.wysum,
sjr2 = sjr.aprjul/sjr.wysum, all1  = (sac.octmar + sjr.octmar)/(sac.wysum + sjr.wysum),
all2 = (sac.aprjul + sjr.aprjul)/(sac.wysum + sjr.wysum), all21 = (sac.octmar + sjr.octmar)/(sac.aprjul + sjr.aprjul))
ratios = ts(ratios, s = 1901)
plot(ratios[, 14:20])
d <- data.frame(ratios)
qplot(wy, all21, data = d, geom = cs(smooth, line), span = 1)
r8r <- ts(runoff.8r[, 2:7], s=1901)
r8r <- window(r8r, s=1950)
ans <- matrix(NA, ncol=2, nrow=6)
colnames(ans) <- cs(trend, sig)
for (i in 1:6) {
ans[i, ] <- unlist(mannKen(r8r[, i])[c(1, 3)])
}
ans
r8ra <- apply(r8r[, 1:4], 1, sum)
r8rb <- apply(r8r[, 5:6], 1, sum)
mannKen(ts(r8ra/r8rb))
qplot(wy, all21, data = d, geom = cs(smooth, line), span = 1)
setwd("~/Documents/Tahoe2010/analysis")
setwd('~/documents/tahoe2010/analysis')
library(wq)
sourceDir('~/RPackages/wq_package/wq/R')  # latest revisions of wq
load('tahoe.rda')
load('tahoemon.rda')
View(tahoemon)
plotTsTile(secmon)
secmon <- tahoemon[, 'sec']
plotTsTile(secmon)
invsecmon <- 1/tahoemon[, 'sec']
plotTsTile(invsecmon)
plotTsTile(invsecmon, square=F)
plotTsTile(invsecmon)
plotTsTile(invsecmon, square=T)
setwd("~/Documents/SFEwq/analysis")
source("/Users/alanjassby/RPackages/wq_package/initialize.R",echo=TRUE)
